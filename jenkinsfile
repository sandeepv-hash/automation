pipeline {

  agent any
  
  parameters {

        choice(choices: ['apply','destroy'], description: '', name: 'trigger')
        strin
  
     stages {

            stage("Terraform init") {
            when {
             
                expression { params.trigger == 'apply' }
                }
           
             steps{

                   sh script: "/usr/local/bin/terraform init"
                   
               }
            }
            
            stage("Terraform Plan") {
            when {
             
                expression { params.trigger == 'apply' }
                }
            
             steps{
                   sh script: "/usr/local/bin/terraform plan" 
               }
            }

            stage("Terraform Apply") {
            
            when {
             
                expression { params.trigger == 'apply' }
                }
             steps{
                   sh script: "/usr/local/bin/terraform apply -auto-approve"
               }
            }
            
            stage("Terraform Destroy") {
            when {
             
                expression { params.trigger == 'destroy' }
                }
            
             steps{
                   sh script: "/usr/local/bin/terraform destroy -auto-approve"
               }
            }

      }
    }
